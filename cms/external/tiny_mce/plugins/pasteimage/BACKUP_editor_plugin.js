tinymce.create("tinymce.plugins.PasteImage",{MAX_SIZE:10485760,docElem:null,init:function(a){var b=this;a.onPaste.add(function(a,c){if("clipboardData"in c)if("items"in c.clipboardData){var d=c.clipboardData.items[0],e,f;d&&(e=d.getAsFile(),e&&e.size<=b.MAX_SIZE&&(f=new FileReader,f.readAsDataURL(e),b.onLoadStart(),f.onload=function(c){b.insertImage(a,c.target.result),b.onLoadEnd()}))}else if("types"in c.clipboardData){var g=c.clipboardData.types;g.indexOf("public.url")>-1&&(c.preventDefault(),b.insertImage(a,c.clipboardData.getData("public.url")))}}),a.onInit.add(function(a){var c=a.getDoc();tinyMCE.dom.Event.add(c,"drop",function(c){b.onDrop(c,a)}),b.docElem=c.documentElement})},onDrop:function(a,b){var c=this;if(a.dataTransfer&&a.dataTransfer.files){var d=a.dataTransfer.files,e=d.length;if(e){for(var f=0;f<e;f++){var g=d[f];if(g.type.indexOf("image/")>-1&&g.size<c.MAX_SIZE){var h=new FileReader;h.readAsDataURL(g),c.onLoadStart(),h.onload=function(a){c.insertImage(b,a.target.result),c.onLoadEnd()}}else b.settings.files_drop_callback(g)}a.preventDefault()}}},onLoadStart:function(){tinyMCE.DOM.addClass(this.docElem,"mceLoading")},onLoadEnd:function(){tinyMCE.DOM.removeClass(this.docElem,"mceLoading")},insertImage:function(a,b){var c=new Image;c.src=b,c.onload=function(){a.execCommand("mceInsertContent",!1,c.outerHTML)}}}),tinymce.PluginManager.add("pasteimage",tinymce.plugins.PasteImage)